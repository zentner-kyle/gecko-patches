# HG changeset patch
# User Kyle Zentner <kzentner@mozilla.com>
# Parent  1b7b495d05f4384d93453641c39a617b90ab97d4
Bug 1170781 - Patch 2: Test CSS 'contain: paint'.

diff --git a/layout/reftests/w3c-css/submitted/contain/paint-clip-001-ref.html b/layout/reftests/w3c-css/submitted/contain/paint-clip-001-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/w3c-css/submitted/contain/paint-clip-001-ref.html
@@ -0,0 +1,23 @@
+<!DOCTYPE HTML>
+<html>
+<head>
+  <meta charset="utf-8">
+  <title>CSS Reftest Reference</title>
+  <link rel="author" title="Kyle Zentner" href="mailto:kzentner@mozilla.com">
+  <style>
+  body {
+    margin: 0;
+  }
+  #a {
+      width: 150px;
+      height: 150px;
+      background: green;
+      margin: 25px;
+  }
+  </style>
+</head>
+<body>
+  <div id="a">
+  </div>
+</body>
+</html>
diff --git a/layout/reftests/w3c-css/submitted/contain/paint-clip-001.html b/layout/reftests/w3c-css/submitted/contain/paint-clip-001.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/w3c-css/submitted/contain/paint-clip-001.html
@@ -0,0 +1,69 @@
+<!DOCTYPE HTML>
+<html>
+<head>
+  <meta charset="utf-8">
+  <title>CSS Test: 'contain: paint' with various overflowing block descendants.</title>
+  <link rel="author" title="Kyle Zentner" href="mailto:kzentner@mozilla.com">
+  <link rel="help" href="http://www.w3.org/TR/css-containment-1/#containment-paint">
+  <link rel="match" href="paint-clip-001-ref.html">
+  <style>
+  body {
+    margin: 0;
+  }
+  .root {
+    contain: paint;
+    width: 100px;
+    height: 100px;
+    background: green;
+    margin: 25px;
+    padding: 25px;
+  }
+  .a {
+    width: 100px;
+    height: 200px;
+    background: red;
+  }
+  .b {
+    width: 100px;
+    height: 100px;
+    background: green;
+  }
+  .c {
+    width: 100px;
+    height: 100px;
+    background: red;
+  }
+  .background {
+    position: absolute;
+    top: 0;
+    left: 0;
+    width: 200px;
+    height: 200px;
+    background: red;
+    z-index: -1;
+  }
+  .foreground {
+    position: absolute;
+    top: 0;
+    left: 0;
+    width: 150px;
+    height: 150px;
+    border: 25px solid red;
+    z-index: 1;
+  }
+  </style>
+</head>
+<body>
+  <div class="root">
+    <div class="a">
+      <div class="b"> </div>
+      <div class="c"> </div>
+      <!--These two absolutely positioned elements are checking that all sides are-->
+      <!--clipped.  They also test that clipping is done correctly on absolutely-->
+      <!--positioned elements.-->
+      <div class="background"> </div>
+      <div class="foreground"> </div>
+    </div>
+  </div>
+</body>
+</html>
diff --git a/layout/reftests/w3c-css/submitted/contain/paint-clip-002-ref.html b/layout/reftests/w3c-css/submitted/contain/paint-clip-002-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/w3c-css/submitted/contain/paint-clip-002-ref.html
@@ -0,0 +1,34 @@
+<!DOCTYPE HTML>
+<html>
+<head>
+  <meta charset="utf-8">
+  <title>CSS Reftest Reference</title>
+  <link rel="author" title="Kyle Zentner" href="mailto:kzentner@mozilla.com">
+  <style>
+  body {
+    margin: 0;
+  }
+  .root {
+    width: 100px;
+    height: 100px;
+    background: green;
+    margin: 25px;
+    padding: 25px;
+  }
+  /* Since we need to clip to the *content* box, setting overflow: hidden on
+   * .root is not enough. */
+  .container {
+    overflow: hidden;
+    width: 100px;
+    height: 100px;
+  }
+  </style>
+</head>
+<body>
+  <div class="root">
+    <div class="container">
+      This text should be clipped to the box. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer nec odio. Praesent libero. Sed cursus ante dapibus diam. Sed nisi. Nulla quis sem at nibh elementum imperdiet. Duis sagittis ipsum. Praesent mauris. Fusce nec tellus sed augue semper porta. Mauris massa. Vestibulum lacinia arcu eget nulla. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Curabitur sodales ligula in libero. 
+    </div>
+  </div>
+</body>
+</html>
diff --git a/layout/reftests/w3c-css/submitted/contain/paint-clip-002.html b/layout/reftests/w3c-css/submitted/contain/paint-clip-002.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/w3c-css/submitted/contain/paint-clip-002.html
@@ -0,0 +1,28 @@
+<!DOCTYPE HTML>
+<html>
+<head>
+  <meta charset="utf-8">
+  <title>CSS Test: 'contain: paint' with various overflowing block descendants.</title>
+  <link rel="author" title="Kyle Zentner" href="mailto:kzentner@mozilla.com">
+  <link rel="help" href="http://www.w3.org/TR/css-containment-1/#containment-paint">
+  <link rel="match" href="paint-clip-002-ref.html">
+  <style>
+  body {
+    margin: 0;
+  }
+  .root {
+    contain: paint;
+    width: 100px;
+    height: 100px;
+    background: green;
+    margin: 25px;
+    padding: 25px;
+  }
+  </style>
+</head>
+<body>
+  <div class="root">
+    This text should be clipped to the box. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer nec odio. Praesent libero. Sed cursus ante dapibus diam. Sed nisi. Nulla quis sem at nibh elementum imperdiet. Duis sagittis ipsum. Praesent mauris. Fusce nec tellus sed augue semper porta. Mauris massa. Vestibulum lacinia arcu eget nulla. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Curabitur sodales ligula in libero. 
+  </div>
+</body>
+</html>
diff --git a/layout/reftests/w3c-css/submitted/contain/paint-containing-block-absolute-001-ref.html b/layout/reftests/w3c-css/submitted/contain/paint-containing-block-absolute-001-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/w3c-css/submitted/contain/paint-containing-block-absolute-001-ref.html
@@ -0,0 +1,23 @@
+<!DOCTYPE HTML>
+<html>
+<head>
+  <meta charset="utf-8">
+  <title>CSS Reftest Reference</title>
+  <link rel="author" title="Kyle Zentner" href="mailto:kzentner@mozilla.com">
+  <style>
+  body {
+    margin: 0;
+  }
+  #a {
+      width: 100px;
+      height: 100px;
+      background: green;
+      margin: 50px;
+  }
+  </style>
+</head>
+<body>
+  <div id="a">
+  </div>
+</body>
+</html>
diff --git a/layout/reftests/w3c-css/submitted/contain/paint-containing-block-absolute-001.html b/layout/reftests/w3c-css/submitted/contain/paint-containing-block-absolute-001.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/w3c-css/submitted/contain/paint-containing-block-absolute-001.html
@@ -0,0 +1,38 @@
+<!DOCTYPE HTML>
+<html>
+<head>
+  <meta charset="utf-8">
+  <title>CSS Test: 'contain: paint' element should contain absolute position elements.</title>
+  <link rel="author" title="Kyle Zentner" href="mailto:kzentner@mozilla.com">
+  <link rel="help" href="http://www.w3.org/TR/css-containment-1/#containment-paint">
+  <link rel="match" href="paint-containing-block-absolute-001-ref.html">
+  <style>
+  body {
+    margin: 0;
+  }
+  #a {
+      contain: paint;
+      width: 100px;
+      height: 100px;
+      background: red;
+      margin: 50px;
+  }
+  #b {
+      position: absolute;
+      width: 100px;
+      height: 100px;
+      background: green;
+      top: 0;
+      left: 0;
+  }
+  </style>
+</head>
+<body>
+  <div id="a">
+    <div>
+      <div id="b">
+      </div>
+    </div>
+  </div>
+</body>
+</html>
diff --git a/layout/reftests/w3c-css/submitted/contain/paint-containing-block-fixed-001-ref.html b/layout/reftests/w3c-css/submitted/contain/paint-containing-block-fixed-001-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/w3c-css/submitted/contain/paint-containing-block-fixed-001-ref.html
@@ -0,0 +1,23 @@
+<!DOCTYPE HTML>
+<html>
+<head>
+  <meta charset="utf-8">
+  <title>CSS Reftest Reference</title>
+  <link rel="author" title="Kyle Zentner" href="mailto:kzentner@mozilla.com">
+  <style>
+  body {
+    margin: 0;
+  }
+  #a {
+      width: 100px;
+      height: 100px;
+      background: green;
+      margin: 50px;
+  }
+  </style>
+</head>
+<body>
+  <div id="a">
+  </div>
+</body>
+</html>
diff --git a/layout/reftests/w3c-css/submitted/contain/paint-containing-block-fixed-001.html b/layout/reftests/w3c-css/submitted/contain/paint-containing-block-fixed-001.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/w3c-css/submitted/contain/paint-containing-block-fixed-001.html
@@ -0,0 +1,38 @@
+<!DOCTYPE HTML>
+<html>
+<head>
+  <meta charset="utf-8">
+  <title>CSS Test: 'contain: paint' element should contain fixed position elements.</title>
+  <link rel="author" title="Kyle Zentner" href="mailto:kzentner@mozilla.com">
+  <link rel="help" href="http://www.w3.org/TR/css-containment-1/#containment-paint">
+  <link rel="match" href="paint-containing-block-fixed-001-ref.html">
+  <style>
+  body {
+    margin: 0;
+  }
+  #a {
+      contain: paint;
+      width: 100px;
+      height: 100px;
+      background: red;
+      margin: 50px;
+  }
+  #b {
+      position: fixed;
+      top: 0;
+      left: 0;
+      width: 100px;
+      height: 100px;
+      background: green;
+  }
+  </style>
+</head>
+<body>
+  <div id="a">
+    <div>
+      <div id="b">
+      </div>
+    </div>
+  </div>
+</body>
+</html>
diff --git a/layout/reftests/w3c-css/submitted/contain/paint-formatting-context-float-001-ref.html b/layout/reftests/w3c-css/submitted/contain/paint-formatting-context-float-001-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/w3c-css/submitted/contain/paint-formatting-context-float-001-ref.html
@@ -0,0 +1,30 @@
+<!DOCTYPE HTML>
+<html>
+<head>
+  <meta charset="utf-8">
+  <title>CSS Reftest Reference</title>
+  <link rel="author" title="Kyle Zentner" href="mailto:kzentner@mozilla.com">
+  <style>
+  body {
+    margin: 0;
+  }
+  #left {
+    float: left;
+    height: 50px;
+    width: 10px;
+    background: blue;
+  }
+  #a {
+    background: green;
+    margin: 10px;
+    width: 50px;
+    height: 50px;
+  }
+  </style>
+</head>
+<body>
+  <div id="left"> </div>
+  <div id="a">
+  </div>
+</body>
+</html>
diff --git a/layout/reftests/w3c-css/submitted/contain/paint-formatting-context-float-001.html b/layout/reftests/w3c-css/submitted/contain/paint-formatting-context-float-001.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/w3c-css/submitted/contain/paint-formatting-context-float-001.html
@@ -0,0 +1,41 @@
+<!DOCTYPE HTML>
+<html>
+<head>
+  <meta charset="utf-8">
+  <title>CSS Test: 'contain: paint' should contain floats as a formatting context.</title>
+  <link rel="author" title="Kyle Zentner" href="mailto:kzentner@mozilla.com">
+  <link rel="help" href="http://www.w3.org/TR/css-containment-1/#containment-paint">
+  <link rel="match" href="paint-formatting-context-float-001-ref.html">
+  <style>
+  body {
+    margin: 0;
+  }
+  #left {
+    float: left;
+    height: 50px;
+    width: 10px;
+    background: blue;
+  }
+  #a {
+    contain: paint;
+    background: red;
+    margin: 10px;
+    width: 50px;
+    height: 50px;
+  }
+  #b {
+    clear: left;
+    width: 50px;
+    height: 50px;
+    background: green;
+  }
+  </style>
+</head>
+<body>
+  <div id="left"> </div>
+  <div id="a">
+    <div id="b">
+    </div>
+  </div>
+</body>
+</html>
diff --git a/layout/reftests/w3c-css/submitted/contain/paint-formatting-context-margin-001-ref.html b/layout/reftests/w3c-css/submitted/contain/paint-formatting-context-margin-001-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/w3c-css/submitted/contain/paint-formatting-context-margin-001-ref.html
@@ -0,0 +1,33 @@
+<!DOCTYPE HTML>
+<html>
+<head>
+  <meta charset="utf-8">
+  <title>CSS Reftest Test</title>
+  <link rel="author" title="Kyle Zentner" href="mailto:kzentner@mozilla.com">
+  <style>
+  body {
+    margin: 0;
+  }
+  #a {
+      background: blue;
+      margin: 10px;
+      width: 50px;
+      height: 50px;
+  }
+  #b {
+      width: 50px;
+      height: 40px;
+      background: green;
+  }
+  #b-padding {
+      height: 10px;
+  }
+  </style>
+</head>
+<body>
+  <div id="a">
+    <div id="b-padding"></div>
+    <div id="b"> </div>
+  </div>
+</body>
+</html>
diff --git a/layout/reftests/w3c-css/submitted/contain/paint-formatting-context-margin-001.html b/layout/reftests/w3c-css/submitted/contain/paint-formatting-context-margin-001.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/w3c-css/submitted/contain/paint-formatting-context-margin-001.html
@@ -0,0 +1,39 @@
+<!DOCTYPE HTML>
+<html>
+<head>
+  <meta charset="utf-8">
+  <title>CSS Test: 'contain: paint' with a vertical margin child. Margin collapse should not occur.</title>
+  <link rel="author" title="Kyle Zentner" href="mailto:kzentner@mozilla.com">
+  <link rel="help" href="http://www.w3.org/TR/css-containment-1/#containment-paint">
+  <link rel="match" href="paint-formatting-context-margin-001-ref.html">
+  <style>
+  body {
+    margin: 0;
+  }
+  #a {
+      contain: paint;
+      background: blue;
+      margin: 10px;
+      width: 50px;
+      height: 50px;
+  }
+  #b {
+      width: 50px;
+      height: 40px;
+      background: green;
+      margin-top: 10px;
+  }
+  #c {
+      background: red;
+      width: 50px;
+      height: 10px;
+  }
+  </style>
+</head>
+<body>
+  <div id="a">
+    <div id="b"> </div>
+    <div id="c"> </div>
+  </div>
+</body>
+</html>
diff --git a/layout/reftests/w3c-css/submitted/contain/reftest.list b/layout/reftests/w3c-css/submitted/contain/reftest.list
new file mode 100644
--- /dev/null
+++ b/layout/reftests/w3c-css/submitted/contain/reftest.list
@@ -0,0 +1,8 @@
+default-preferences pref(layout.css.contain.enabled,true)
+
+== paint-clip-001.html paint-clip-001-ref.html
+== paint-clip-002.html paint-clip-002-ref.html
+== paint-containing-block-absolute-001.html paint-containing-block-absolute-001-ref.html
+== paint-containing-block-fixed-001.html paint-containing-block-fixed-001-ref.html
+== paint-formatting-context-float-001.html paint-formatting-context-float-001-ref.html
+== paint-formatting-context-margin-001.html paint-formatting-context-margin-001-ref.html
diff --git a/layout/reftests/w3c-css/submitted/reftest.list b/layout/reftests/w3c-css/submitted/reftest.list
--- a/layout/reftests/w3c-css/submitted/reftest.list
+++ b/layout/reftests/w3c-css/submitted/reftest.list
@@ -14,16 +14,19 @@ include css21/reftest.list
 # include animations/reftest.list
 
 # Backgrounds and Borders Level 3
 # include background3/reftest.list
 
 # Conditional Rules Level 3
 include conditional3/reftest.list
 
+# Containment
+include contain/reftest.list
+
 # Flexible Box Layout Module
 include flexbox/reftest.list
 
 # Fonts Level 3
 include fonts3/reftest.list
 
 # Image Values and Replaced Content Level 3
 include images3/reftest.list
